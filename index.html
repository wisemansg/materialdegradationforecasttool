<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Material Degradation Forecast Tool</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --text-light: #64748b;
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --success: #16a34a;
      --warning: #ea580c;
      --danger: #dc2626;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 2rem 1rem;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    header h1 {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--text);
    }

    header p {
      font-size: 1.1rem;
      color: var(--text-light);
      margin-top: 0.5rem;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 2rem;
    }

    .sidebar {
      background: var(--surface);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border);
    }

    .content {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .card {
      background: var(--surface);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border);
    }

    h2, h3 {
      font-weight: 600;
      margin-bottom: 1rem;
    }

    h2 { font-size: 1.4rem; color: var(--primary); }
    h3 { font-size: 1.15rem; }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.4rem;
      font-size: 0.95rem;
      color: var(--text-light);
    }

    select, input[type="number"], input[type="range"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      background: white;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
    }

    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.8rem;
      margin-top: 0.5rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.95rem;
      cursor: pointer;
    }

    input[type="checkbox"] {
      accent-color: var(--primary);
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #analyze-btn {
      background: var(--primary);
      color: white;
      border: none;
    }

    #analyze-btn:hover {
      background: var(--primary-dark);
    }

    #reset-btn {
      background: #e2e8f0;
      color: var(--text);
      border: 1px solid var(--border);
    }

    #reset-btn:hover {
      background: #cbd5e1;
    }

    .status {
      padding: 1.2rem;
      border-radius: 10px;
      font-weight: 500;
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .loading { background: rgba(37,99,235,0.1); color: var(--primary); }
    .error   { background: rgba(220,38,38,0.1); color: #b91c1c; }

    .chart-card {
      padding: 1.5rem;
    }

    .chart-container {
      height: 340px;
    }

    .pill {
      font-size: 1.8rem;
      font-weight: 700;
      text-align: center;
      padding: 1.2rem;
      border-radius: 12px;
      margin-bottom: 1.2rem;
    }

    .pill.low    { background: rgba(22,163,74,0.1); color: #15803d; }
    .pill.medium { background: rgba(234,179,8,0.1); color: #a16207; }
    .pill.high   { background: rgba(220,38,38,0.1); color: #b91c1c; }

    .insights-grid {
      display: grid;
      gap: 1rem;
    }

    .insight-item {
      background: #f8fafc;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .insight-icon {
      font-size: 1.4rem;
      color: var(--primary);
      margin-top: 0.2rem;
    }

    @media (max-width: 1100px) {
      .main-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Material Degradation Forecast Tool</h1>
    <p>Location-Aware Engineering Decision Dashboard</p>
  </header>

  <div class="main-grid">
    <!-- Left sidebar - Inputs -->
    <div class="sidebar">
      <div class="field">
        <label>Country</label>
        <select id="country-select">
          <option value="">Select country...</option>
        </select>
      </div>

      <div class="field">
        <label>Material Family</label>
        <select id="material-family">
          <option value="metals">Metals</option>
          <option value="polymers">Polymers</option>
          <option value="ceramics">Ceramics</option>
          <option value="composites">Composites</option>
        </select>
      </div>

      <div class="field">
        <label>Material</label>
        <select id="material-select"></select>
      </div>

      <div class="field">
        <label>Degradation Mode</label>
        <select id="degradation-mode">
          <option value="corrosion">Corrosion</option>
          <option value="oxidation">Oxidation</option>
          <option value="embrittlement">Embrittlement</option>
          <option value="uv">UV / Environmental Degradation</option>
        </select>
      </div>

      <div class="field">
        <label>Protective Measures</label>
        <div class="checkbox-grid">
          <label class="checkbox-label"><input type="checkbox" value="coating"> Coating / Paint</label>
          <label class="checkbox-label"><input type="checkbox" value="galvanizing"> Galvanizing</label>
          <label class="checkbox-label"><input type="checkbox" value="anodizing"> Anodizing</label>
          <label class="checkbox-label"><input type="checkbox" value="inhibitor"> Corrosion Inhibitor</label>
          <label class="checkbox-label"><input type="checkbox" value="passivation"> Passivation</label>
          <label class="checkbox-label"><input type="checkbox" value="design"> Design Optimization</label>
          <label class="checkbox-label"><input type="checkbox" value="thermal"> Thermal Spray</label>
        </div>
      </div>

      <div class="field">
        <label>Time Horizon (years)</label>
        <input type="range" id="years" min="1" max="50" value="20">
        <div style="text-align:center; margin-top:0.5rem;" id="years-value">20 years</div>
      </div>

      <div class="btn-group">
        <button id="analyze-btn">Analyze</button>
        <button id="reset-btn">Reset</button>
      </div>
    </div>

    <!-- Right side - Results -->
    <div class="content">
      <div id="status" class="status hidden"></div>

      <div class="card chart-card">
        <h3>Degradation Forecast</h3>
        <div class="chart-container">
          <canvas id="degradation-chart"></canvas>
        </div>
      </div>

      <div class="card">
        <h3>Risk Assessment</h3>
        <div id="risk-pill" class="pill">Select inputs to begin</div>
      </div>

      <div class="card">
        <h3>Engineering Insights & Recommendations</h3>
        <div id="insights" class="insights-grid"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // ────────────────────────────────────────────────
  // Data
  // ────────────────────────────────────────────────

  const materialData = {
    metals: [
      { name: "Carbon Steel", corrosion: 0.3, oxidation: 0.5, embrittlement: 0.4, uv: 0.9, cost: 0.4 },
      { name: "Stainless Steel 304", corrosion: 0.85, oxidation: 0.75, embrittlement: 0.6, uv: 0.9, cost: 2.0 },
      { name: "Stainless Steel 316", corrosion: 0.9, oxidation: 0.8, embrittlement: 0.65, uv: 0.9, cost: 2.5 },
      { name: "Aluminum 6061", corrosion: 0.7, oxidation: 0.4, embrittlement: 0.5, uv: 0.8, cost: 1.5 },
      { name: "Titanium Grade 5", corrosion: 0.95, oxidation: 0.85, embrittlement: 0.7, uv: 0.95, cost: 6.0 },
      { name: "Copper C110", corrosion: 0.6, oxidation: 0.6, embrittlement: 0.4, uv: 0.7, cost: 2.2 },
      { name: "Inconel 625", corrosion: 0.95, oxidation: 0.95, embrittlement: 0.75, uv: 0.9, cost: 8.0 }
    ],
    polymers: [
      { name: "ABS", corrosion: 0.6, oxidation: 0.3, embrittlement: 0.2, uv: 0.4, cost: 0.8 },
      { name: "Nylon 6/6", corrosion: 0.5, oxidation: 0.4, embrittlement: 0.25, uv: 0.4, cost: 1.2 },
      { name: "PEEK", corrosion: 0.9, oxidation: 0.8, embrittlement: 0.4, uv: 0.5, cost: 15.0 },
      { name: "Polycarbonate", corrosion: 0.6, oxidation: 0.5, embrittlement: 0.3, uv: 0.4, cost: 1.8 },
      { name: "PTFE", corrosion: 0.95, oxidation: 0.9, embrittlement: 0.6, uv: 0.7, cost: 4.0 }
    ],
    ceramics: [
      { name: "Alumina (99%)", corrosion: 0.95, oxidation: 0.9, embrittlement: 0.2, uv: 0.95, cost: 6.0 },
      { name: "Zirconia", corrosion: 0.9, oxidation: 0.85, embrittlement: 0.3, uv: 0.9, cost: 8.5 }
    ],
    composites: [
      { name: "CFRP (Epoxy)", corrosion: 0.9, oxidation: 0.6, embrittlement: 0.8, uv: 0.7, cost: 12.0 },
      { name: "GFRP (Polyester)", corrosion: 0.75, oxidation: 0.5, embrittlement: 0.5, uv: 0.6, cost: 4.0 }
    ]
  };

  const degradationWeights = {
    corrosion:     { humidity:0.4, temp:0.3, pollution:0.2, coastal:0.1 },
    oxidation:     { humidity:0.1, temp:0.6, pollution:0.2, coastal:0.1 },
    embrittlement: { humidity:0.3, temp:0.2, pollution:0.4, coastal:0.1 },
    uv:            { humidity:0.2, temp:0.2, pollution:0.1, coastal:0.1, uv:0.4 }
  };

  const protectionData = {
    coating:        { eff:0.55, cost:1.2, maint:6  },
    galvanizing:    { eff:0.6,  cost:1.4, maint:7  },
    anodizing:      { eff:0.45, cost:1.3, maint:5  },
    inhibitor:      { eff:0.4,  cost:1.1, maint:4  },
    passivation:    { eff:0.5,  cost:1.15, maint:6 },
    design:         { eff:0.35, cost:1.05, maint:8 },
    'thermal-spray':{ eff:0.65, cost:1.5, maint:5  }
  };

  // ────────────────────────────────────────────────
  // DOM
  // ────────────────────────────────────────────────

  const els = {
    country:       document.getElementById('country-select'),
    family:        document.getElementById('material-family'),
    material:      document.getElementById('material-select'),
    mode:          document.getElementById('degradation-mode'),
    years:         document.getElementById('years'),
    yearsValue:    document.getElementById('years-value'),
    analyze:       document.getElementById('analyze-btn'),
    reset:         document.getElementById('reset-btn'),
    status:        document.getElementById('status'),
    pill:          document.getElementById('risk-pill'),
    insights:      document.getElementById('insights'),
    chart:         document.getElementById('degradation-chart').getContext('2d')
  };

  let chartInstance = null;

  // ────────────────────────────────────────────────
  // Country loading
  // ────────────────────────────────────────────────

  async function loadCountries() {
    try {
      const r = await fetch('https://restcountries.com/v3.1/all?fields=name,cca2');
      const data = await r.json();
      data.sort((a,b) => a.name.common.localeCompare(b.name.common));
      data.forEach(c => {
        const o = document.createElement('option');
        o.value = c.cca2;
        o.textContent = c.name.common;
        els.country.appendChild(o);
      });
      els.country.value = 'US'; // default
    } catch {
      ['United States','Norway','Germany','China','India','Nigeria','Japan','United Kingdom']
        .forEach(c => {
          const o = document.createElement('option');
          o.value = c;
          o.textContent = c;
          els.country.appendChild(o);
        });
    }
  }

  // ────────────────────────────────────────────────
  // Material family → class
  // ────────────────────────────────────────────────

  function updateMaterialOptions() {
    const family = els.family.value;
    els.material.innerHTML = '';
    materialData[family].forEach(m => {
      const opt = document.createElement('option');
      opt.value = m.name;
      opt.textContent = m.name;
      els.material.appendChild(opt);
    });
  }

  // ────────────────────────────────────────────────
  // Core calculation & update
  // ────────────────────────────────────────────────

  function runForecast() {
    els.status.className = 'status loading';
    els.status.textContent = 'Calculating degradation forecast...';
    els.status.classList.remove('hidden');

    setTimeout(() => { // simulate calculation
      const country = els.country.value;
      const family = els.family.value;
      const matName = els.material.value;
      const mode = els.mode.value;
      const years = parseInt(els.years.value);

      const material = materialData[family].find(m => m.name === matName);
      if (!material) return;

      // Simulated environmental factor (0–1)
      const envSeverity = 0.3 + Math.random() * 0.5; // placeholder – use real data later

      // Base resistance (0–1, higher = better)
      const resistance = mode === 'corrosion' ? material.corrosion :
                        mode === 'oxidation' ? material.oxidation :
                        mode === 'embrittlement' ? material.embrittlement : material.uv;

      // Base degradation rate
      let rate = envSeverity * (1 - resistance);

      // Apply protections
      document.querySelectorAll('.checkbox-grid input:checked').forEach(cb => {
        const p = protectionData[cb.value];
        if (p) rate *= (1 - p.eff);
      });

      // Generate curve
      const curve = [];
      for (let y = 1; y <= years; y++) {
        curve.push(Math.min(rate * y * 100, 100));
      }

      // Risk level
      const finalDeg = curve[curve.length-1];
      let riskLevel = finalDeg < 30 ? 'low' :
                      finalDeg < 60 ? 'medium' : 'high';

      els.pill.textContent = riskLevel === 'low' ? 'Low Risk' :
                             riskLevel === 'medium' ? 'Moderate Risk' : 'High Risk';
      els.pill.className = `pill ${riskLevel}`;

      // Insights
      els.insights.innerHTML = '';
      const tips = [
        `Estimated degradation after ${years} years: ${finalDeg.toFixed(1)}%`,
        `Primary driver: ${mode.charAt(0).toUpperCase() + mode.slice(1)}`,
        `Material resistance rating: ${(resistance * 100).toFixed(0)}%`,
        finalDeg > 50 ? 'Consider more robust protection strategy.' : 'Current setup appears adequate for this timeframe.'
      ];

      tips.forEach(t => {
        const div = document.createElement('div');
        div.className = 'insight-item';
        div.innerHTML = `<i class="fas fa-info-circle"></i> ${t}`;
        els.insights.appendChild(div);
      });

      // Chart
      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(els.chart, {
        type: 'line',
        data: {
          labels: Array.from({length: years}, (_,i) => `Year ${i+1}`),
          datasets: [{
            label: 'Degradation (%)',
            data: curve,
            borderColor: riskLevel === 'high' ? '#dc2626' :
                         riskLevel === 'medium' ? '#ea580c' : '#16a34a',
            backgroundColor: 'rgba(37,99,235,0.08)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { min: 0, max: 100, title: { display: true, text: 'Degradation Level (%)' } },
            x: { title: { display: true, text: 'Time' } }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });

      els.status.classList.add('hidden');
    }, 600);
  }

  // ────────────────────────────────────────────────
  // Events
  // ────────────────────────────────────────────────

  els.analyze.onclick = runForecast;

  els.reset.onclick = () => {
    els.family.value = 'metals';
    updateMaterialOptions();
    els.material.value = materialData['metals'][0].name;
    els.mode.value = 'corrosion';
    els.years.value = 20;
    els.yearsValue.textContent = '20 years';
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    if (chartInstance) chartInstance.destroy();
    els.pill.textContent = 'Select inputs to begin';
    els.pill.className = 'pill';
    els.insights.innerHTML = '';
    els.status.classList.add('hidden');
  };

  els.years.oninput = () => {
    els.yearsValue.textContent = `${els.years.value} years`;
  };

  els.family.onchange = updateMaterialOptions;

  // Init
  updateMaterialOptions();
  loadCountries(); // async – will populate dropdown
</script>
</body>
</html>
